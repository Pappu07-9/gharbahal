<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2p-5mily=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>

<body class="w-screen overflow-x-hidden">
    <div class="w-full">
        <div class="flex p-5 bg-gradient-to-r items-center from-green-300 to-green-800 justify-between">
            <p class="m-3 justify-between w-1/5">Welcome to <strong>GharBahal.com</strong></p>
            <form action="get" class="m-3 justify-between w-3/5 items-center">
                <input type="text" class="h-10 w-4/5 border-2 bg-green-100 border-green-800 rounded"
                    placeholder="Search Properties">
                <button type="submit" class="border border-green-700 bg-green-700 p-2 rounded">Search</button>
            </form>
            <div id="loginstatus" class="flex w-1/5">

            </div>
        </div>
        <div class="flex bg-blue-100 w-full h-screen">
            <div class="w-1/5 bg-blue-500" id="sidebar">this is sidebar</div>
            <div class="w-4/5 bg-red-500 grow overflow-y-auto">


            </div>
        </div>
        <div class="flex bg-pink-500 h-64">
            <p>this is footer</p>
            <p>this line 2</p>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () { checkToken(); });

        function handlesuccess(res) {
            const loginStatus = document.getElementById("loginstatus")
            const { success, data, message } = res
            const sidebar = document.getElementById("sidebar")
            const trending = document.getElementById("trending")

            if (success) {
                loginStatus.innerHTML = `
                    <p class="text-black px-3 py-2 rounded">Welcome, ${data.username}</p>
                    <a href="/logout" id="logout" class="text-black hover:bg-green-900 hover:text-white px-3 py-2 rounded">Logout</a>
                `

                document.getElementById("logout").addEventListener('click', function (e) {
                    e.preventDefault();
                    localStorage.removeItem("Authorization");
                    checkToken();
                });
            }
            else {
                loginStatus.innerHTML = `
                    <a href="login" class="text-black hover:bg-black hover:text-white px-3 py-2 rounded">Login</a>
                    <a href="register" class="text-black hover:bg-black hover:text-white px-3 py-2 rounded">Register</a>
                `;
                sidebar.style.display = "none";

            }


        };
        async function checkToken() {
            const token = JSON.parse(localStorage.getItem("Authorization"))
            try {
                const response = await fetch("/api/checktoken", {
                    method: "GET",
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    }
                });

                const res = await response.json();
                handlesuccess(res);
            }
            catch (error) {
                console.log("error", error);
            }

        };



    </script>
</body>

</html>